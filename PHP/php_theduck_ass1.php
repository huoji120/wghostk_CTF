<p>第二关:学会质疑</p>
<p>-黑客就是要打破规则的.</p>
<link rel='stylesheet' type='text/css' href='https://cdn.bootcss.com/SyntaxHighlighter/3.0.83/styles/shCoreRDark.css'/>
<div class="syntaxhighlighter  php" id="highlighter_286779"><div class="toolbar"><span><a class="toolbar_item command_help help" href="#">?</a></span></div><table border="0" cellspacing="0" cellpadding="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php functions">ini_set</code><code class="php plain">(</code><code class="php string">"display_errors"</code><code class="php plain">,0);</code></div><div class="line number2 index1 alt1"><code class="php keyword">function</code>&nbsp;<code class="php plain">GetCSRFtoken()&nbsp;&nbsp;&nbsp;</code></div><div class="line number3 index2 alt2"><code class="php plain">{&nbsp;&nbsp;&nbsp;</code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//..error&nbsp;404,&nbsp;&nbsp;data&nbsp;was&nbsp;no&nbsp;found</code></div><div class="line number5 index4 alt2"><code class="php plain">}</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="php keyword">if</code><code class="php plain">(isset(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'flag'</code><code class="php plain">])&nbsp;&amp;&amp;&nbsp;</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'flag'</code><code class="php plain">]&nbsp;===&nbsp;</code><code class="php string">"flag{**********************************************}"</code><code class="php plain">)</code></div><div class="line number8 index7 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">die</code><code class="php plain">(</code><code class="php string">"NEXT&nbsp;The&nbsp;Door&nbsp;:******************"</code><code class="php plain">);</code></div><div class="line number9 index8 alt2"><code class="php keyword">if</code><code class="php plain">(isset(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'json'</code><code class="php plain">])&nbsp;&amp;&amp;&nbsp;</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'json'</code><code class="php plain">])</code></div><div class="line number10 index9 alt1"><code class="php plain">{</code></div><div class="line number11 index10 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$AntiCSRFtoken</code>&nbsp;<code class="php plain">=&nbsp;GetCSRFtoken();</code></div><div class="line number12 index11 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$json</code>&nbsp;<code class="php plain">=&nbsp;json_decode(</code><code class="php variable">$_GET</code><code class="php plain">[</code><code class="php string">'json'</code><code class="php plain">]);</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php functions">empty</code><code class="php plain">(</code><code class="php variable">$json</code><code class="php plain">-&gt;TheBaseName))</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">die</code><code class="php plain">(</code><code class="php string">"What??"</code><code class="php plain">);</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php functions">empty</code><code class="php plain">(</code><code class="php variable">$json</code><code class="php plain">-&gt;token)&nbsp;||&nbsp;</code><code class="php variable">$AntiCSRFtoken</code>&nbsp;<code class="php plain">!=&nbsp;</code><code class="php variable">$json</code><code class="php plain">-&gt;token)</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">die</code><code class="php plain">(</code><code class="php string">'Anti&nbsp;CSRF!'</code><code class="php plain">);</code></div><div class="line number17 index16 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">else</code><code class="php plain">{</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$json</code><code class="php plain">-&gt;TheBaseName&nbsp;!==&nbsp;</code><code class="php string">"huoji"</code><code class="php plain">)</code></div><div class="line number19 index18 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">die</code><code class="php plain">(</code><code class="php string">'fuck&nbsp;u'</code><code class="php plain">);</code></div><div class="line number20 index19 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code>&nbsp;<code class="php string">'flag{**************************}'</code><code class="php plain">;</code></div><div class="line number21 index20 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number22 index21 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div>
<?php
ini_set("display_errors",0);
function GetCSRFtoken($length)   
{   
    $pattern = '1234567890';  
    for($i=0;$i<$length;$i++)   
    {   
        $key .= $pattern{mt_rand(0,10)};
    }   
    return (int)$key;   
}
if(isset($_GET['flag']) && $_GET['flag'] === "flag{THIS_CTF_MEAN_PHP_IS_THE_BEST_language_IN_the_world}")
	die("Next Door : php_dark_duck_dusk2.php");
if(isset($_GET['json']) && $_GET['json'])
{
	$AntiCSRFtoken = GetCSRFtoken(8);
	$json = json_decode($_GET['json']);
	if(empty($json->TheBaseName))
		die("What??");
	if(empty($json->token) || $AntiCSRFtoken != $json->token)
		die('Anti CSRF!');
	else{
		if($json->TheBaseName !== "huoji")
			die('fuck u');
		echo 'thx , this is ur flag: flag{THIS_CTF_MEAN_PHP_IS_THE_BEST_language_IN_the_world}';
		echo '<p>不负责的恋爱,受伤的只有女方罢了。</p>.';
	}
}else
	echo '很多时候,真正对女生好的,真正负责的男生少之又少.小学到大学期间的情侣有多少个没开过房的?男方一边打着"我爱你一生一世",一边让女方怀孕然后流产.这就是所谓的"负责"么?这就是所谓的"对人好么".又有多少个男人能承担起对女方的负责?'; 
?>